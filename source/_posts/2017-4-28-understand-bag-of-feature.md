---
title: 浅析 Bag of Feature
date: 2017-04-28 22:40:12
tags: [计算机视觉, 机器学习]
categories: 计算机视觉
---

Bag of Feature 是一种图像分类方法，它借鉴了文本分类的思路（Bag of Words），将图像抽象出很多具有代表性的「关键词」，形成一个字典，再统计每张图片中出现的「关键词」数量，来决定图片的类别归属。

![bag-of-feature](/images/2017-4-29/bag-of-feature.png)

<!--more-->

### Bag of Words 模型

要了解「Bag of Feature」，首先要知道「Bag of Words」。

「Bag of Words」 是文本分类中一种通俗易懂的策略。一般来讲，如果我们要了解一段文本的主要内容，最行之有效的策略是抓取文本中的关键词，根据关键词出现的频率确定这段文本的中心思想。比如：如果一则新闻中经常出现「iraq」、「terrorists」，那么，我们可以认为这则新闻应该跟伊拉克的恐怖主义有关。而如果一则新闻中出现较多的关键词是「soviet」、「cuba」，我们又可以猜测这则新闻是关于冷战的（见下图）。![bag-of-words](/images/2017-4-29/bag-of-words.png)

这里所说的关键词，就是**「Bag of words」**中的 **words** ，它们是区分度较高的单词。根据这些 words ，我们可以很快地识别出文章的内容，并快速地对文章进行分类。

而**「Bag of Feature」**也是借鉴了这种思路，只不过在图像中，我们抽出的不再是一个个「word」，而是图像的关键特征「Feature」，所以研究人员将它更名为「Bag of Feature」。

### Bag of Feature 算法

从上面的讨论中，我们不难发现，**「Bag of Feature」的本质是提出一种图像的特征表示方法**。

按照「Bag of Feature」算法的思想，首先我们要找到图像中的关键词，而且这些关键词必须具备较高的区分度。实际过程中，通常会采用「SIFT」特征。

有了特征之后，我们会将这些特征通过聚类算法得出很多聚类中心。这些聚类中心通常具有较高的代表性，比如，对于人脸来说，虽然不同人的眼睛、鼻子等特征都不尽相同，但它们往往具有共性，而这些聚类中心就代表了这类共性。我们将这些聚类中心组合在一起，形成一部**字典（CodeBook）**。

对于图像中的每个「SIFT」特征，我们能够在字典中找到最相似的聚类中心，统计这些聚类中心出现的次数，可以得到一个向量表示（有些文章称之为「直方图」），如本文开篇的图片所示。这些向量就是所谓的「Bag」。这样，对于不同类别的图片，这个向量应该具有较大的区分度，基于此，我们可以训练出一些分类模型（SVM等），并用其对图片进行分类。

### Bag of Feature 算法过程

「Bag of Feature」大概分为四步：

1. 提取图像特征；
2. 对特征进行聚类，得到一部字典（ visual vocabulary ）；
3. 根据字典将图片表示成向量（直方图）；
4. 训练分类器（这一步严格来讲不属于「Bag of Feature」，但为了系统讲一下分类流程，我将它包含进来）。

下面，我们简单分析一下每一步的实现过程。

#### 提取图像特征

特征必须具有较高的区分度，而且要满足旋转不变性以及尺寸不变性等，因此，我们通常都会采用「SIFT」特征（有时为了降低计算量，也会采用其他特征，如：SURF ）。「SIFT」会从图片上提取出很多特征点，每个特征点都是 128 维的向量，因此，如果图片足够多的话，我们会提取出一个巨大的特征向量库。

#### 训练字典（ visual vocabulary ）

提取完特征后，我们会采用一些聚类算法对这些特征向量进行聚类。最常用的聚类算法是 **k-means**。至于 k-means 中的 k 如何取，要根据具体情况来确定。另外，由于特征的数量可能非常庞大，这个聚类的过程也会非常漫长。

![visual vocabulary](/images/2017-4-29/visual vocabulary.png)

聚类完成后，我们就得到了这 k 个向量组成的字典。

#### 图片直方图表示

上一步训练得到的字典，是为了这一步对图像特征进行量化。对于一幅图像而言，我们可以提取出大量的「SIFT」特征点，但这些特征点仍然属于一种浅层（low level）的表达，缺乏代表性。因此，这一步的目标，是根据字典重新提取图像的高层特征。

具体做法是，对于图像中的每一个「SIFT」特征，都可以在字典中找到一个最相似的向量，这样，我们可以统计一个 k 维的直方图，代表该图像的「SIFT」特征在字典中的相似度频率。

![code-word](/images/2017-4-29/code-word.png)

例如：对于上图这辆车的图片，我们匹配图片的「SIFT」向量与字典中的向量，统计出最相似的向量出现的次数，最后得到这幅图片的直方图向量。

#### 训练分类器

当我们得到每幅图片的直方图向量后，剩下的这一步跟以往的步骤是一样的。无非是根据数据库图片的向量以及图片的标签，训练分类器模型。然后对需要预测的图片，我们仍然按照上述方法，提取「SIFT」特征，再根据字典量化直方图向量，用分类器模型对直方图向量进行分类。

### Bag of Feature 在检索中的应用

「Bag of Feature」虽然是针对图像分类提出的算法，但它同样可以用到图像检索中。检索和分类本质上是同样的，但在细节上会有不同，事实上，我更愿意把检索当成一种精细分类，即得到图片的大致分类后，再在这个分类中找出最相似的图片。



### 参考

+ [Bag-of-words model in computer vision](https://en.wikipedia.org/wiki/Bag-of-words_model_in_computer_vision)
+ [Bag of Features (BOF)图像检索算法](http://blog.csdn.net/chlele0105/article/details/9633397)